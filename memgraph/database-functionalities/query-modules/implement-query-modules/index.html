<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Memgraph Docs Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Memgraph Docs Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Memgraph Docs" href="/opensearch.xml">
<script src="https://docs.memgraph.com/js/load-analytics.js"></script><title data-react-helmet="true">Implement custom query modules | Memgraph Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Implement custom query modules | Memgraph Docs"><meta data-react-helmet="true" name="description" content="We are going to examine how the query module example is implemented using"><meta data-react-helmet="true" property="og:description" content="We are going to examine how the query module example is implemented using"><meta data-react-helmet="true" property="og:url" content="https://docs.memgraph.com/memgraph/database-functionalities/query-modules/implement-query-modules"><link data-react-helmet="true" rel="shortcut icon" href="/img/social-logo-round-corners.png"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://docs.memgraph.com/memgraph/database-functionalities/query-modules/implement-query-modules"><link rel="stylesheet" href="/styles.0dc48699.css">
<link rel="preload" href="/styles.59fcf1e7.js" as="script">
<link rel="preload" href="/runtime~main.77e09379.js" as="script">
<link rel="preload" href="/main.9d857d09.js" as="script">
<link rel="preload" href="/1.87301906.js" as="script">
<link rel="preload" href="/2.51806c2b.js" as="script">
<link rel="preload" href="/105.007cf896.js" as="script">
<link rel="preload" href="/108.8571e3f8.js" as="script">
<link rel="preload" href="/935f2afb.0f6a0534.js" as="script">
<link rel="preload" href="/17896441.83e9fdd2.js" as="script">
<link rel="preload" href="/93dd2ce2.19aa0884.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/social-logo-round-corners.png" alt="Memgraph Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/social-logo-round-corners.png" alt="Memgraph Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Docs</strong></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/memgraph/overview">Memgraph DB</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/memgraph/getting-started">Getting started</a></li><li><a class="dropdown__link" href="/memgraph/getting-started/installation">Installation</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/memgraph/database-functionalities">Database functionalities</a></li><li><a class="dropdown__link" href="/memgraph/getting-started/connecting-applications">Building applications</a></li><li><a class="dropdown__link" href="/memgraph/reference-guide">Reference guide</a></li></ul></div><a class="navbar__item navbar__link" href="/memgraph-lab/">Memgraph Lab</a><a class="navbar__item navbar__link" href="/memgraph-cloud/">Memgraph Cloud</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" href="/cypher-manual/">Cypher manual</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cypher-manual/">Overview</a></li><li><a class="dropdown__link" href="/cypher-manual/functions">Functions</a></li><li><a class="dropdown__link" href="/cypher-manual/clauses">Clauses</a></li><li><a class="dropdown__link" href="/cypher-manual/other-features">Other features</a></li><li><a class="dropdown__link" href="/cypher-manual/differences">Differences</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/memgraph" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/social-logo-round-corners.png" alt="Memgraph Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/social-logo-round-corners.png" alt="Memgraph Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Docs</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a aria-current="page" class="menu__link menu__link--sublist navbar__link--active" role="button" href="/memgraph/overview">Memgraph DB</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/memgraph/getting-started">Getting started</a></li><li class="menu__list-item"><a class="menu__link" href="/memgraph/getting-started/installation">Installation</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/memgraph/database-functionalities">Database functionalities</a></li><li class="menu__list-item"><a class="menu__link" href="/memgraph/getting-started/connecting-applications">Building applications</a></li><li class="menu__list-item"><a class="menu__link" href="/memgraph/reference-guide">Reference guide</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/memgraph-lab/">Memgraph Lab</a></li><li class="menu__list-item"><a class="menu__link" href="/memgraph-cloud/">Memgraph Cloud</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" role="button" href="/cypher-manual/">Cypher manual</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/cypher-manual/">Overview</a></li><li class="menu__list-item"><a class="menu__link" href="/cypher-manual/functions">Functions</a></li><li class="menu__list-item"><a class="menu__link" href="/cypher-manual/clauses">Clauses</a></li><li class="menu__list-item"><a class="menu__link" href="/cypher-manual/other-features">Other features</a></li><li class="menu__list-item"><a class="menu__link" href="/cypher-manual/differences">Differences</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/memgraph" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/memgraph/overview">Overview</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-started">Where to start?</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Installation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-started/installation">Installation overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-started/installation/docker-installation">Docker (Windows, Linux, macOS)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-started/installation/debian-installation">Debian GNU/Linux</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-started/installation/rpm-installation">RPM package</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Querying the database</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-started/querying/querying">Querying the database</a></li><li class="menu__list-item"><a href="https://docs.memgraph.com/memgraph-lab" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Memgraph Lab</a></li><li class="menu__list-item"><a href="https://playground.memgraph.com/" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Memgraph Playground</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Building applications</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-started/connecting-applications">Building applications</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-started/connecting-applications/python">Python</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-started/connecting-applications/rust">Rust</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-started/connecting-applications/c-sharp">C#</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-started/connecting-applications/java">Java</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-started/connecting-applications/go">Go</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-started/connecting-applications/javascript">JavaScript</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tutorials</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/tutorials/tutorials">Tutorials overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/tutorials/analyzing-ted-talks">Analyzing TED Talks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/tutorials/backpacking-through-europe">Backpacking through Europe</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/tutorials/exploring-the-european-road-network">Exploring the European road network</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/tutorials/football-transfers">Football transfers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/tutorials/graphing-the-premier-league">Graphing the Premier League</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/tutorials/marvel-universe">Marvel Comic Universe social network</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/tutorials/movie-recommendation">Movie recommendation system</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/tutorials/social-network-analysis">Social network analysis with NetworkX</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/tutorials/understanding-music-with-modules">Understanding music (with query modules)</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Database functionalities</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/memgraph/database-functionalities">Database functionalities overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/memgraph/database-functionalities/import-data">Import data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/memgraph/database-functionalities/inspecting-queries">Inspecting queries</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/memgraph/database-functionalities/profiling-queries">Profiling queries</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/memgraph/database-functionalities/tensorflow-setup">TensorFlow Op</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/memgraph/reference-guide/backup">Backup</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Enforcing constraints</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/database-functionalities/constraints/existence-constraint">Existence constraint</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/database-functionalities/constraints/uniqueness-constraint">Uniqueness constraint</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Query modules</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/memgraph/database-functionalities/query-modules/built-in-query-modules">Built-in query modules</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/memgraph/database-functionalities/query-modules/load-call-query-modules">Load and call custom query modules</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/memgraph/database-functionalities/query-modules/implement-query-modules">Implement custom query modules</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/memgraph/database-functionalities/manage-user-privileges">User privileges (Enterprise)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/memgraph/database-functionalities/manage-users-using-ldap">Authentication and authorization (Enterprise)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/memgraph/database-functionalities/replication">Replication (Enterprise)</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Reference guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide">Reference guide overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/configuration">Memgraph configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/indexing">Indexing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/graph-algorithms">Graph algorithms</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/tensorflow">TensorFlow Op</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/backup">Backup</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Query modules</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/query-modules">Query modules</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/query-modules/c-api">C API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/query-modules/python-api">Python API</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">NetworkX</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/networkx">NetworkX overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/networkx/graph-analyzer">Graph Analyzer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/networkx/nxalg">NetworkX Algorithms</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/networkx/wcc">Weakly Connected Components</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/security">Security (Enterprise)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/auth-module">Auth module (Enterprise)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/ldap-security">LDAP Security (Enterprise)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/audit-log">Audit log (Enterprise)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/replication">Replication (Enterprise)</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Concepts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/concepts">Concepts overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/concepts/storage">Storage</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/concepts/graph-algorithms">Graph algorithms</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/concepts/indexing">Indexing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/concepts/replication">Replication</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Drivers</a><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/memgraph/mgclient" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">C/C++</a></li><li class="menu__list-item"><a href="https://github.com/memgraph/mgconsole" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">CLI Console</a></li><li class="menu__list-item"><a href="https://github.com/memgraph/pymgclient" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Python</a></li><li class="menu__list-item"><a href="https://github.com/memgraph/rsmgclient" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Rust</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/memgraph/upcoming-features">Upcoming features</a></li><li class="menu__list-item"><a class="menu__link" href="/memgraph/changelog">Changelog</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting help</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-help/getting-help">Getting help</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-help/faq">FAQ</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Implement custom query modules</h1></header><div class="markdown"><p>We are going to examine how the query module <code>example</code> is implemented using
the C API and the Python API. Both query modules can be found in the
<code>/usr/lib/memgraph/query-modules</code> directory.</p><h2 id="using-docker-with-query-modules">Using Docker with query modules</h2><p>If you are using Docker to run Memgraph you will have to create a volume
and mount it to access the <code>query-modules</code> directory. This can be done by
creating an empty directory <code>~modules</code> and executing the following command:</p><pre><code class="language-shell">docker volume create --driver local --opt type=none  --opt device=~modules --opt o=bind modules
</code></pre><p>Now, you can start Memgraph and mount the created volume:</p><pre><code class="language-shell">docker run -it --rm -v modules:/usr/lib/memgraph/query-modules -p 7687:7687 memgraph
</code></pre><p>Everything from the directory <code>/usr/lib/memgraph/query-modules</code> will be
visible/editable in your mounted <code>modules</code> volume and vice versa.</p><h2 id="python-api">Python API</h2><p>Query modules can be implemented using the Python API provided by Memgraph.
If you wish to write your own query modules using the Python API, you need
to have Python version <code>3.5.0</code> or above installed.</p><p>Let&#x27;s take a look at the <code>py_example.py</code> file.</p><pre><code class="language-python">import mgp
</code></pre><p>On the first line, we import the <code>mgp</code> module, which contains definitions of the
public Python API provided by Memgraph. In essence, this is a wrapper around the
C API described in the next section. This file (<code>mgp.py</code>) can be found in
the Memgraph installation directory, under <code>python_support</code>. On the standard
Debian installation, this will be under <code>/usr/lib/memgraph/python_support</code>.</p><p>Next, we have a <code>procedure</code> function. This function will serve as the callback
for our <code>py_example.procedure</code> invocation through openCypher.</p><pre><code class="language-python">@mgp.read_proc
def procedure(context: mgp.ProcCtx,
              required_arg: mgp.Nullable[mgp.Any],
              optional_arg: mgp.Nullable[mgp.Any] = None
              ) -&gt; mgp.Record(args=list,
                              vertex_count=int,
                              avg_degree=mgp.Number,
                              props=mgp.Nullable[mgp.Map]):

  ...
</code></pre><p>This procedure needs to be callable which optionally takes <code>ProcCtx</code> as the
first argument. Other arguments will be bound to values passed in the
cypher query. The full signature of this procedure needs to be annotated
with types. The return type must be <code>Record(field_name=type, ...)</code> and the
procedure must produce either a complete <code>Record</code> or <code>None</code>. As you can see,
the procedure is passed to a <code>read_proc</code> decorator which handles read-only
procedures. You can also inspect the definition of said decorator in the
<code>mgp.py</code> file or take a look at the Python API <a href="/memgraph/reference-guide/query-modules/python-api">reference guide</a>.</p><p>In our case, the example procedure returns 4 fields:</p><ul><li><code>args</code>: a copy of arguments passed to the procedure.</li><li><code>vertex_count</code>: number of vertices in the database.</li><li><code>avg_degree</code>: average degree of vertices.</li><li><code>props</code>: properties map of the Vertex or Edge object passed in <code>required_arg</code>.
In case a Path instance is passed, the procedure returns the properties map of
the starting vertex.</li></ul><p>This procedure can be invoked in openCypher as follows:</p><pre><code class="language-cypher">MATCH (n) WITH n LIMIT 1 CALL py_example.procedure(n, 1) YIELD * RETURN *;
</code></pre><p>The following lines create the properties map for a received Edge, Vertex
or Path instance:</p><pre><code class="language-python">if isinstance(required_arg, (mgp.Edge, mgp.Vertex)):
    props = dict(required_arg.properties.items())
elif isinstance(required_arg, mgp.Path):
    start_vertex, = required_arg.vertices
    props = dict(start_vertex.properties.items())
</code></pre><p>As you can see, in the case of <code>mgp.Edge</code> and <code>mgp.Vertex</code>, we obtain an
instance of <code>mgp.Properties</code> class which holds the respective properties by
accessing the <code>properties</code> property of our <code>mgp.Edge</code> or <code>mgp.Vertex</code> instance.
Once we have access to <code>mgp.Properties</code> instance, we can simply invoke the
<code>items()</code> method which returns an <code>Iterable</code> that contains <code>mgp.Property</code>
objects. Since the type of <code>mgp.Property</code> is a simple <code>collections.namedtuple</code>
containing <code>name</code> and <code>value</code>, we can easily pass it to a <code>dict</code> constructor.</p><p>We go on to counting the number of vertices and edges in our graph:</p><pre><code class="language-python">vertex_count = 0
edge_count = 0
for v in context.graph.vertices:
    vertex_count += 1
    edge_count += sum(1 for e in v.in_edges)
    edge_count += sum(1 for e in v.out_edges)
</code></pre><p>As you can see, we can access the <code>mgp.Graph</code> instance through <code>context.graph</code>.
This instance contains the state of our database when executing the cypher query
that called our procedure. A <code>mgp.Graph</code> instance has a property <code>vertices</code>
which allows us to access a <code>mgp.Vertices</code> object which can be iterated upon.</p><p>Similarly, each <code>mgp.Vertex</code> object has <code>in_edges</code> and <code>out_edges</code> properties
which allow us to iterate over the corresponding <code>mgp.Edge</code> objects. The rest of the
code logic from the previous snippet is self-explanatory, we simply increase the
adequate variables on each traversed vertex or edge.</p><p>After that we calculate the average degree and obtain a copy of the passed
arguments:</p><pre><code class="language-python">avg_degree = 0 if vertex_count == 0 else edge_count / vertex_count
args_copy = [copy.deepcopy(required_arg), copy.deepcopy(optional_arg)]
</code></pre><p>Finally, we return a <code>mgp.Record</code> with all the calculated values:</p><pre><code class="language-python">return mgp.Record(args=args_copy, vertex_count=vertex_count,
                  avg_degree=avg_degree, props=props)
</code></pre><p>In conclusion, Python API provided by Memgraph can be a very powerful, yet
simple tool when implementing query modules. Therefore, we strongly suggest
that all users thoroughly inspect the <code>mgp.py</code> source file.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>NOTE: You should not globally store any graph elements when writing your own
query modules with the intent to use them in a different procedure invocation.</p></div></div><h2 id="c-api">C API</h2><p>Query modules can be implemented using the C API provided by Memgraph. Such
modules need to be compiled to a shared library so that they can be loaded
when Memgraph starts. This means that you can write the procedures in any
programming language which can work with C and can be compiled to the ELF
shared library format.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>WARNING: If your programming language of choice throws exceptions, these
exceptions must never leave the scope of your module! You should have a top-level
exception handler which returns with an error value and potentially logs
the error message. Exceptions which cross the module boundary will cause all
sorts of unexpected issues.</p></div></div><p>Let&#x27;s take a look at the <code>example.c</code> file.</p><pre><code class="language-c">#include &quot;mg_procedure.h&quot;
</code></pre><p>On the first line, we include <code>mg_procedure.h</code>, which contains declarations of
all functions that can be used to implement a query module procedure. This file
is found in the Memgraph installation directory, under <code>include/memgraph</code>. On
the standard Debian installation, this will be under <code>/usr/include/memgraph</code>.
To compile the module, you will have to pass the appropriate flags to the
compiler. For example, using <code>clang</code>:</p><pre><code class="language-plaintext">clang -Wall -shared -fPIC -I /usr/include/memgraph example.c -o example.so
</code></pre><p>Next, we have a <code>procedure</code> function. This function will serve as the callback
for our <code>example.procedure</code> invocation through openCypher.</p><pre><code class="language-c">static void procedure(const struct mgp_list *args, const struct mgp_graph *graph,
                      struct mgp_result *result, struct mgp_memory *memory) {
  ...
}
</code></pre><p>If this were C++ you&#x27;d probably write the function as such:</p><pre><code class="language-cpp">namespace {
void procedure(const mgp_list *args, const mgp_graph *graph,
               mgp_result *result, mgp_memory *memory) {
  try {
    ...
  } catch (const std::exception &amp;e) {
    // We must not let any exceptions out of our module.
    mgp_result_set_error_msg(result, e.what());
    return;
  }
}
}
</code></pre><p>The <code>procedure</code> function will receive the list of arguments (<code>args</code>) which are
passed in the query. The parameter <code>result</code> is used to fill in the resulting
records of the procedure. Parameters <code>graph</code> and <code>memory</code> are context
parameters of the procedure, and they are used in some parts of the provided C
API. For more information on what exactly is possible via C API, take a look
at the <code>mg_procedure.h</code> file  or at the C API <a href="/memgraph/reference-guide/query-modules/c-api">reference guide</a>,
as well as the <code>example.c</code> found in <code>/usr/lib/memgraph/query-modules/src</code></p><p>Then comes the required <code>mgp_init_module</code> function. Its primary purpose is to
register procedures which can then be invoked through openCypher. Although the
example registers a single <code>procedure</code>, you can register multiple different
procedures in a single module. Each of these can be invoked using
<code>CALL &lt;module&gt;.&lt;procedure&gt; ...</code> syntax. The <code>&lt;module-name&gt;</code> will correspond to
the name of the shared library. Since we compile our example into
<code>example.so</code>, then the module is called <code>example</code>. Procedure names can be
different than their corresponding implementation callbacks because the
procedure name is defined when registering a procedure.</p><pre><code class="language-c">int mgp_init_module(struct mgp_module *module, struct mgp_memory *memory) {
  // Register our `procedure` as a read procedure with the name &quot;procedure&quot;.
  struct mgp_proc *proc =
      mgp_module_add_read_procedure(module, &quot;procedure&quot;, procedure);
  // Return non-zero on error.
  if (!proc) return 1;
  // Additional code for better specifying the procedure (omitted here).
  ...
  // Return 0 to indicate success.
  return 0;
}
</code></pre><p>The omitted part specifies the signature of the registered procedure. The
signature specification states what kind of arguments a procedure accepts and
what will be the resulting set of the procedure. For information on signature
specification API, take a look at <code>mg_procedure.h</code> file and read the
documentation on functions prefixed with <code>mgp_proc_</code>.</p><p>The passed in <code>memory</code> argument is only alive throughout the execution of
<code>mgp_init_module</code>, so you must not allocate any global resources with it. If
you really need to set up some global state, you may do so in the
<code>mgp_init_module</code> but using the standard global allocators.</p><p>Consequently, you may want to reset any global state or release global
resources in the following function.</p><pre><code class="language-c">int mgp_shutdown_module() {
  // Return 0 to indicate success.
  return 0;
}
</code></pre><p>As previously mentioned, no exceptions should leave your module. If you are
writing the module in a language that throws them, you probably want
exception handlers in <code>mgp_init_module</code> and <code>mgp_shutdown_module</code> as well.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/memgraph/docs/tree/master/docs/database-functionalities/query-modules/implement-query-modules.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/memgraph/database-functionalities/query-modules/load-call-query-modules"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Load and call custom query modules</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/memgraph/database-functionalities/manage-user-privileges"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">User privileges (Enterprise) Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#using-docker-with-query-modules" class="table-of-contents__link">Using Docker with query modules</a></li><li><a href="#python-api" class="table-of-contents__link">Python API</a></li><li><a href="#c-api" class="table-of-contents__link">C API</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Documentation</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/memgraph/overview">Memgraph DB</a></li><li class="footer__item"><a class="footer__link-item" href="/memgraph-lab">Memgraph Lab</a></li><li class="footer__item"><a class="footer__link-item" href="/memgraph-cloud">Memgraph Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/cypher-manual">Cypher manual</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/memgraphdb" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discourse.memgraph.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Developer Forum</a></li><li class="footer__item"><a href="https://twitter.com/memgraphdb" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/memgraph" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCZ3HOJvHGxtQ_JHxOselBYg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://memgraph.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_31Aa"><img class="footer__logo" alt="Memgraph Logo" src="/img/Memgraph-logo-white-rgb.png"></a></div><div class="footer__copyright">Copyright Â© 2021 Memgraph. Built by developers, for developers!</div></div></div></footer></div>
<script src="/styles.59fcf1e7.js"></script>
<script src="/runtime~main.77e09379.js"></script>
<script src="/main.9d857d09.js"></script>
<script src="/1.87301906.js"></script>
<script src="/2.51806c2b.js"></script>
<script src="/105.007cf896.js"></script>
<script src="/108.8571e3f8.js"></script>
<script src="/935f2afb.0f6a0534.js"></script>
<script src="/17896441.83e9fdd2.js"></script>
<script src="/93dd2ce2.19aa0884.js"></script>
</body>
</html>